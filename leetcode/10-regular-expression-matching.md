# 10. 正则表达式匹配

## 題目描述

给你一个字符串 s 和一个字符规律 p，请你来实现一个支持 `'.'` 和 `'*'` 的正则表达式匹配。

    '.' 匹配任意单个字符
    '*' 匹配零个或多个前面的那一个元素
所谓匹配，是要涵盖 整个 字符串 `s`的，而不是部分字符串。

说明:

- s 可能为空，且只包含从 a-z 的小写字母。
- p 可能为空，且只包含从 a-z 的小写字母，以及字符 . 和 *。

示例 1:

    输入:
    s = "aa"
    p = "a"
    输出: false
    解释: "a" 无法匹配 "aa" 整个字符串。
示例 2:

    输入:
    s = "aa"
    p = "a*"
    输出: true
    解释: 因为 '*' 代表可以匹配零个或多个前面的那一个元素, 在这里前面的元素就是 'a'。因此，字符串 "aa" 可被视为 'a' 重复了一次。
示例 3:

    输入:
    s = "ab"
    p = ".*"
    输出: true
    解释: ".*" 表示可匹配零个或多个（'*'）任意字符（'.'）。
示例 4:

    输入:
    s = "aab"
    p = "c*a*b"
    输出: true
    解释: 因为 '*' 表示零个或多个，这里 'c' 为 0 个, 'a' 被重复一次。因此可以匹配字符串 "aab"。
示例 5:

    输入:
    s = "mississippi"
    p = "mis*is*p*."
    输出: false

## 有限状态自动机 思路

### 构建有限自动机

首先，我们可以通过遍历模式串p来构造有限状态机，可以从下面的角度来考虑构建的过程：

1. 状态：状态的意义、数量等等；
2. 转移：转移条件、转移限制等等；
3. 初始状态：从哪些状态开始；
4. 终止状态：到达哪些状态算结束；

以本题来说：

1. 状态代表当前匹配的结果；
2. 转移代表，从当前状态下，利用一个字符，可以到达哪些状态；
3. 初始状态代表，没有开始匹配时，应该处在哪一个状态；
4. 终止状态代表，到达这些状态算是匹配结束。

构建方法会在代码的注释中详细叙述，这里说一下构造状态机时，容易忽略的点：

- 自动机可以有不止一个终止状态；
- 直接构建的自动机被称为“非确定的有限自动机(NFA)”。其含义是，从一个状态下，通过某个转移，自动机可能会到达不止一个状态；

### 使用有限自动机

在使用自动机时，将匹配串s输入到自动机中，判断是否能够到达终止状态。
定义两个集合：

- 待转移状态集合preStates：存储了到上一部为止，当前自动机可能到达的所有状态；
- 当前状态集合nowStates：存储了preStates在当前模式串字符的转移下，可能到达的所有状态；

匹配过程如下：

1. 将初始状态加入到待转移状态集合preStates；
2. 对匹配串s的每一个字符s[i]按顺序遍历：
   1. 对于preStates中的每一个状态tranState，我们将试探其是否能够通过当前遍历字符s[i]的转移，到达某些状态，如果是，将可能到达的所有状态加入到nowStates；
   2. 对于preStates中的每一个状态tranState，我们将试探其是否能够通过通配符.的转移，到达某些状态，如果是，将可能到达的所有状态加入到nowStates；
   3. 如果nowStates为空，代表匹配失败，返回false；如果不为空，将preStates更新为nowStates，置空nowStates；
3. 遍历完成后，检查preStates中是否包含终止状态，如果是，则匹配成功，反之匹配失败。

## 复杂度分析

设模式串s的长度为m，匹配串p的长度为n

### 时间复杂度

易知，使用有限自动机匹配时，时间复杂度为O(m)O(m)。下面我们简单分析构建自动机的时间复杂度。

- 如果不考虑*，则构建自动机的时间复杂度为$O(n)$；
- 最坏情况下，p中*的数量达到$\frac{n}{2}$，则此时的时间复杂度为$O(\frac{n(n+1)}{8})$，即$O(n^2)$；
总体时间复杂度为$O(n^2+m)$。

### 空间复杂度

空间复杂度主要由三部分组成：

1. 有限自动机
2. 终止结点集合
3. 状态记录集合

这三部分都正相关于状态的数量。通过观察易知，状态的数量等于模式串p中非*结点的数量 + 1。

对于有限自动机来说，每个状态都要存储相应的转移状态集合。在p中*的数量达到$\frac{n}{2}$ 时，需要保存的状态数量最多有$O(\frac{n(n+1)}{8})$个，即$O(n^2)$ 
所以总体空间复杂度为$O(n^2)$。
